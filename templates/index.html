<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Crop Doctor - Smart Plant Disease Detection</title>
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <!-- Marked.js for Markdown rendering -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <!-- Custom CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

  <style>
    :root {
      --primary-green: #22c55e;
      --primary-dark: #16a34a;
      --secondary-green: #4ade80;
      --light-green: #f0fdf4;
      --gradient-bg: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 50%, #bbf7d0 100%);
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--gradient-bg);
      min-height: 100vh;
    }

    .navbar-brand img {
      transition: transform 0.3s ease;
    }

    .navbar-brand:hover img {
      transform: scale(1.1) rotate(5deg);
    }

    .hero-section {
      background: linear-gradient(rgba(34, 197, 94, 0.1), rgba(34, 197, 94, 0.05)),
                  url('https://images.unsplash.com/photo-1574323347407-f5e1ad6d020b?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      min-height: 100vh;
      display: flex;
      align-items: center;
    }

    .glass-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }

    .glass-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 30px 60px rgba(0, 0, 0, 0.15);
    }

    .upload-zone {
      border: 3px dashed var(--primary-green);
      background: rgba(34, 197, 94, 0.05);
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .upload-zone:hover {
      border-color: var(--primary-dark);
      background: rgba(34, 197, 94, 0.1);
      transform: scale(1.02);
    }

    .upload-zone.dragover {
      border-color: var(--secondary-green);
      background: rgba(74, 222, 128, 0.15);
      transform: scale(1.05);
    }

    .sample-image-card {
      transition: all 0.3s ease;
      cursor: pointer;
      border: 2px solid transparent;
    }

    .sample-image-card:hover {
      transform: translateY(-8px) scale(1.05);
      border-color: var(--primary-green);
      box-shadow: 0 15px 30px rgba(34, 197, 94, 0.3);
    }

    .btn-primary-custom {
      background: linear-gradient(135deg, var(--primary-green), var(--primary-dark));
      border: none;
      padding: 12px 30px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .btn-primary-custom::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: left 0.5s;
    }

    .btn-primary-custom:hover::before {
      left: 100%;
    }

    .btn-primary-custom:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(34, 197, 94, 0.4);
    }

    .feature-icon {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, var(--primary-green), var(--secondary-green));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
      transition: all 0.3s ease;
    }

    .feature-icon:hover {
      transform: scale(1.1) rotate(10deg);
      box-shadow: 0 15px 30px rgba(34, 197, 94, 0.3);
    }

    .confidence-bar {
      height: 8px;
      background: linear-gradient(90deg, #ef4444, #f59e0b, #22c55e);
      border-radius: 10px;
      transition: width 0.8s ease;
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 6px solid #f3f3f3;
      border-top: 6px solid var(--primary-green);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .pulse-animation {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .navbar {
      background: rgba(255, 255, 255, 0.95) !important;
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
    }

    .footer {
      background: linear-gradient(135deg, var(--primary-dark), #064e3b);
    }
  </style>
</head>

<body>
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center" href="/">
        <img src="https://media.istockphoto.com/id/1496224767/vector/vector-cute-farmer-robot-cartoon-illustration-isolated.jpg?s=1024x1024&w=is&k=20&c=Q96xOCkdNNc8-NwUVzO1Ka0CSxIfKxv7z5rKch2rAuo=" 
             alt="AI Crop Doctor" class="rounded-circle me-3" width="50" height="50">
        <span class="fw-bold fs-4 text-success">AI Crop Doctor</span>
      </a>
      
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link fw-semibold" href="/">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link fw-semibold" href="/history_page" target="_blank">History</a>
          </li>
          <li class="nav-item">
            <a class="nav-link fw-semibold" href="/user_guide" target="_blank">User Guide</a>
          </li>
          <li class="nav-item">
            <a class="nav-link fw-semibold" href="/tools" target="_blank">Tools</a>
          </li>
          <li class="nav-item">
            <select class="form-select form-select-sm languageSelect ms-2">
              <option value="en">English</option>
              <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
              <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
              <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
            </select>
          </li>
          <li class="nav-item">
            <button class="btn btn-danger btn-sm ms-2" id="emergencyBtn">
              <i class="fas fa-phone-alt me-1"></i> Emergency
            </button>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div id="mainContent">
    <!-- Hero Section -->
    <section class="hero-section">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-lg-10">
            <!-- Welcome Card -->
            <div class="glass-card rounded-4 p-5 mb-5 text-center">
              <div class="feature-icon pulse-animation">
                <i class="fas fa-seedling text-white fs-1"></i>
              </div>
              <h1 class="display-4 fw-bold text-success mb-4">
                Welcome to <span class="text-primary">AI Crop Doctor</span>
              </h1>
              <p class="lead text-muted mb-4">
                Diagnose <strong class="text-success">plant diseases</strong> instantly with smart 
                <strong class="text-dark">AI</strong> ‚Äî just upload a photo and let technology assist your next step.
              </p>
              <p class="text-muted">
                Powered by <strong>Machine Learning</strong> and <strong>Generative AI</strong>
              </p>
            </div>

            <!-- Upload Section -->
            <div class="glass-card rounded-4 p-5 mb-5">
              <h2 class="text-center mb-4 fw-bold text-success">
                <i class="fas fa-cloud-upload-alt me-2"></i>Upload Plant Image
              </h2>
              
              <div id="drop-area" class="upload-zone rounded-4 p-5 text-center mb-4">
                <i class="fas fa-cloud-upload-alt text-success mb-3" style="font-size: 3rem;"></i>
                <h4 class="text-success mb-3">Drag & Drop your image here</h4>
                <p class="text-muted mb-3">or <span class="text-success fw-semibold">click to browse</span></p>
                <input type="file" id="image-input" accept="image/*" class="d-none">
                <small class="text-muted">Supports: JPG, PNG, JPEG (Max 5MB)</small>
              </div>

              <div id="image-preview-container-initial" class="d-none text-center mb-4">
                <img id="image-preview-initial" class="img-fluid rounded-3 shadow" 
                     style="max-height: 300px;" alt="Image Preview">
                <p id="image-name-initial" class="text-muted mt-2"></p>
              </div>

              <div class="text-center">
                <button id="predict-button" class="btn btn-primary-custom btn-lg rounded-pill" disabled>
                  <i class="fas fa-microscope me-2"></i>Analyze Image
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Sample Images Section -->
    <section class="py-5 bg-light">
      <div class="container">
        <h2 class="text-center mb-5 fw-bold text-success">
          <i class="fas fa-images me-2"></i>Try with Sample Images
        </h2>
        <div class="row g-3" id="sample-images-grid">
          <!-- Sample images will be populated here -->
        </div>
      </div>
    </section>

    <!-- Loading Section -->
    <div id="loading-spinner-initial" class="d-none text-center py-5">
      <div class="loading-spinner mx-auto mb-4"></div>
      <h4 class="text-success">Analyzing your image...</h4>
      <p class="text-muted">Please wait while our AI examines the plant</p>
    </div>

    <!-- Results Section -->
    <div id="disease-detection-section" class="d-none py-5">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-lg-8">
            <div class="glass-card rounded-4 p-5">
              <div class="d-flex align-items-center mb-4">
                <div class="feature-icon me-3" style="width: 60px; height: 60px;">
                  <i class="fas fa-microscope text-white"></i>
                </div>
                <h2 class="fw-bold text-success mb-0">Disease Detection Results</h2>
              </div>
              
              <div class="row">
                <div class="col-md-6">
                  <img id="image-preview-summary" class="img-fluid rounded-3 shadow" alt="Analyzed Image">
                  <p id="image-name-summary" class="text-muted text-center mt-2"></p>
                </div>
                <div class="col-md-6">
                  <div class="bg-light rounded-3 p-4">
                    <h4 class="text-success mb-3">Diagnosis:</h4>
                    <p id="prediction-result" class="fs-5 fw-semibold text-dark mb-3"></p>
                    
                    <h5 class="text-muted mb-2">Confidence Level:</h5>
                    <div class="progress mb-2" style="height: 10px;">
                      <div id="confidence-bar" class="confidence-bar" style="width: 0%;"></div>
                    </div>
                    <span id="confidence-score-text" class="fw-bold text-success"></span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Additional Information Form -->
    <div id="additional-info-section" class="d-none py-5 bg-light">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-lg-10">
            <div class="glass-card rounded-4 p-5">
              <h2 class="text-center mb-4 fw-bold text-warning">
                <i class="fas fa-info-circle me-2"></i>Additional Information
              </h2>
              <p class="text-center text-muted mb-5">Please answer these questions for a more accurate diagnosis:</p>
              
              <div class="row g-4" id="additional-info-content">
                <!-- Form sections will be populated here -->
              </div>
              
              <div class="text-center mt-5">
                <button id="get-report-button" class="btn btn-primary-custom btn-lg rounded-pill">
                  <i class="fas fa-robot me-2"></i>Get AI Diagnosis Report
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading Report -->
    <div id="loading-spinner-report" class="d-none text-center py-5">
      <div class="loading-spinner mx-auto mb-4"></div>
      <h4 class="text-success">Generating your personalized report...</h4>
      <p class="text-muted">Our AI Agronomist is compiling the best advice for you</p>
    </div>

    <!-- Final Report -->
    <div id="report-section-standalone" class="d-none py-5">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-lg-10">
            <div class="glass-card rounded-4 p-5">
              <div class="d-flex align-items-center mb-4">
                <div class="feature-icon me-3" style="width: 60px; height: 60px;">
                  <i class="fas fa-robot text-white"></i>
                </div>
                <h2 class="fw-bold text-success mb-0">AI Agronomist Report</h2>
              </div>
              <div id="final-report-content" class="report-content">
                <!-- Report content will be injected here -->
              </div>
              <div class="text-center mt-4">
                <button id="start-over-button" class="btn btn-secondary btn-lg rounded-pill">
                  <i class="fas fa-redo me-2"></i>Start Over
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Error Message -->
    <div id="error-message" class="d-none">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-lg-8">
            <div class="alert alert-danger rounded-4 shadow">
              <h5 class="alert-heading"><i class="fas fa-exclamation-triangle me-2"></i>Error!</h5>
              <p id="error-text" class="mb-0">Something went wrong. Please try again.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer text-white py-4 mt-5">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-6">
          <p class="mb-0">¬© 2026 AI Crop Doctor. All rights reserved.</p>
        </div>
        <div class="col-md-6 text-md-end">
          <p class="mb-0 fst-italic">Empowering farmers with AI üåø</p>
        </div>
      </div>
    </div>
  </footer>

  <!-- Emergency Modal -->
  <div class="modal fade" id="emergencyModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header bg-danger text-white">
          <h5 class="modal-title">
            <i class="fas fa-exclamation-triangle me-2"></i>Emergency Support
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="emergencyForm">
            <div class="mb-3">
              <label class="form-label fw-semibold">Name *</label>
              <input id="emergencyName" name="name" type="text" class="form-control" required placeholder="Your name">
            </div>
            <div class="mb-3">
              <label class="form-label fw-semibold">Phone Number *</label>
              <input id="emergencyPhone" name="phone" type="tel" class="form-control" required placeholder="e.g., +91 98765 43210">
            </div>
            <div class="mb-3">
              <label class="form-label fw-semibold">Describe your issue *</label>
              <textarea id="emergencyIssue" name="issue" class="form-control" rows="4" required 
                        placeholder="Describe the crop/plant issue, symptoms, and location..."></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label fw-semibold">Upload image (optional, max 2 MB)</label>
              <input type="file" id="userImage" name="image" accept="image/*" class="form-control">
            </div>
          </form>
          <div id="emergencySuccess" class="d-none alert alert-success">
            <i class="fas fa-check-circle me-2"></i>
            Thanks for submitting your issue. Our team will approach you within 24‚Äì48 hours.
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button id="emergencySubmitBtn" type="submit" form="emergencyForm" class="btn btn-danger">
            <i class="fas fa-paper-plane me-2"></i>Submit
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Custom JS -->
  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
  <script src="{{ url_for('static', filename='js/emergency.js') }}"></script>

  <script>
    // Firebase Config
    window.FIREBASE_CONFIG = {{ firebase_context | tojson | safe if firebase_context else '{}' }};
    
    // Ensure main content is visible
    window.addEventListener('DOMContentLoaded', () => {
      const mainContent = document.getElementById('mainContent');
      if (mainContent) mainContent.classList.remove('d-none');
      
      // Initialize sample images
      initializeSampleImages();
      
      // Initialize emergency modal
      const emergencyBtns = document.querySelectorAll('#emergencyBtn, #emergencyBtnMobile');
      emergencyBtns.forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          const modal = new bootstrap.Modal(document.getElementById('emergencyModal'));
          modal.show();
        });
      });
    });

    // Sample images data
    const sampleImages = [
      { path: "{{ url_for('static', filename='images/apple_black-rot.JPG') }}", name: "Apple Black Rot" },
      { path: "{{ url_for('static', filename='images/apple_cedar_rust.JPG') }}", name: "Apple Cedar Rust" },
      { path: "{{ url_for('static', filename='images/apple_healthy.JPG') }}", name: "Apple Healthy" },
      { path: "{{ url_for('static', filename='images/tomato_late_blight.JPG') }}", name: "Tomato Late Blight" },
      { path: "{{ url_for('static', filename='images/potato_early_blight.JPG') }}", name: "Potato Early Blight" },
      { path: "{{ url_for('static', filename='images/grape_healthy.JPG') }}", name: "Grape Healthy" }
    ];

    function initializeSampleImages() {
      const grid = document.getElementById('sample-images-grid');
      sampleImages.forEach((img, index) => {
        const col = document.createElement('div');
        col.className = 'col-lg-2 col-md-3 col-sm-4 col-6';
        col.innerHTML = `
          <div class="sample-image-card card h-100 shadow-sm" data-image-path="${img.path}" data-image-name="${img.name}">
            <img src="${img.path}" class="card-img-top" alt="${img.name}" style="height: 150px; object-fit: cover;">
            <div class="card-body p-2">
              <p class="card-text small text-center fw-semibold">${img.name}</p>
            </div>
          </div>
        `;
        grid.appendChild(col);
      });

      // Add click handlers for sample images
      document.querySelectorAll('.sample-image-card').forEach(card => {
        card.addEventListener('click', function() {
          const imagePath = this.dataset.imagePath;
          const imageName = this.dataset.imageName;
          
          // Update preview
          const preview = document.getElementById('image-preview-initial');
          const nameElement = document.getElementById('image-name-initial');
          const container = document.getElementById('image-preview-container-initial');
          const button = document.getElementById('predict-button');
          
          preview.src = imagePath;
          nameElement.textContent = imageName;
          container.classList.remove('d-none');
          button.disabled = false;
          
          // Scroll to upload section
          document.getElementById('drop-area').scrollIntoView({ behavior: 'smooth' });
        });
      });
    }
  </script>
</body>
</html>